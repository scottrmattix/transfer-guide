
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>View Requests</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.3/jquery.min.js"></script>
</head>
<body class="d-flex flex-column min-vh-100">
    {# Load the tag library #}
    {% extends "base.html" %}
    {% load bootstrap5 %}

    {# Load CSS and JavaScript #}
    {% bootstrap_css %}
    {% bootstrap_javascript %}

    {# Display django.contrib.messages as Bootstrap alerts #}
    {% bootstrap_messages %}

    {% block content %}
    <content>

      <!-- Modal -->
      <div class="modal fade" id="actionModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">

            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Handle Transfer Request</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body text-center">
              <form method="post">
                {% csrf_token %}
                <input type="hidden" name="requestID" id="requestID" value=""/>
                <button class="btn btn-success" formaction="{% url 'accept_request' %}"> Accept </button>
                <button class="btn btn-danger" formaction="{% url 'reject_request' %}"> Reject </button>
              </form>
            </div>

          </div>
        </div>
      </div>

      <!-- Script for passing request ID to modal -->
      <script type="text/javascript">
          $(document).on("click", ".open-ActionModal", function () {
            var requestID = $(this).data('id');
            $(".modal-body #requestID").val( requestID );
          });
      </script>

      <!-- Container for Page Content -->
      <div class="container-fluid p-5" align="left">
        <h3>Requests</h3>

        <!-- Progress Bar -->
        <div class="progress">
          <!-- Accepted -->
          <div class="progress-bar bg-success" role="progressbar" style="width: {{ accepted_pct }}%" aria-valuenow="{{ accepted_pct }}" aria-valuemin="0" aria-valuemax="100"></div>
          <!-- Pending  -->
          <div class="progress-bar bg-info" role="progressbar" style="width: {{ pending_pct }}%" aria-valuenow="{{ pending_pct }}" aria-valuemin="0" aria-valuemax="100"></div>
          <!-- Rejected  -->
          <div class="progress-bar bg-danger" role="progressbar" style="width: {{ rejected_pct }}%" aria-valuenow="{{ rejected_pct }}" aria-valuemin="0" aria-valuemax="100"></div>
        </div>

        <!-- Define Tabs -->
        <ul class="nav nav-tabs" id="myTab" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="pending-tab" data-bs-toggle="tab" data-bs-target="#pending" type="button" role="tab" aria-controls="pending" aria-selected="true">Pending</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="accepted-tab" data-bs-toggle="tab" data-bs-target="#accepted" type="button" role="tab" aria-controls="accepted" aria-selected="false">Accepted</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="rejected-tab" data-bs-toggle="tab" data-bs-target="#rejected" type="button" role="tab" aria-controls="rejected" aria-selected="false">Rejected</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="all-tab" data-bs-toggle="tab" data-bs-target="#all" type="button" role="tab" aria-controls="all" aria-selected="false">All</button>
          </li>
        </ul>

        <!-- Table Headings -->
        <div class="card">
          <div class="card-header d-flex">
            <div class="col-3 text-center">College</div>
            <div class="col-4 text-center">Course</div>
            <div class="col-4 text-center">UVA Equivalent</div>
            <div class="col-1 text-center"></div>
          </div>

          <!-- Tab Content -->
          <div class="tab-content" id="myTabContent">
            <!-- Pending Requests -->
            <div class="tab-pane fade show active" id="pending" role="tabpanel" aria-labelledby="pending-tab">
              <ul class="list-group">
                {% if pending %}
                  {% for r in pending %}
                    <li class="list-group-item list-group-item-{{ r.color }} d-flex">
                      <div class="col-3 text-center"><a class="list-group-item list-group-item-{{ r.color }} h-100">{{ r.transfer.external_course.college_name }}</a></div>
                      <div class="col-4 text-center"><a href="{{ r.url }}" class="list-group-item list-group-item-{{ r.color }} list-group-item-action h-100">{{ r.transfer.external_course }}</a></div>
                      <div class="col-4 text-center"><a href="{% url 'internalcourse' r.transfer.internal_course.pk %}" class="list-group-item list-group-item-{{ r.color }} list-group-item-action h-100">{{ r.transfer.internal_course }}</a></div>
                      <div class="col-1 text-center"><button type="button" data-id="{{ r.id }}" class="open-ActionModal btn btn-{{ r.btn }}" data-bs-toggle="modal" data-bs-target="#actionModal">⋮</button></div>
                    </li>
                  {% endfor %}
                {% else %}
                  <li class="list-group-item list-group-item-light d-flex">No Pending Transfer Requests Found.</li>
                {% endif %}
              </ul>
            </div>

            <!-- Accepted Requests -->
            <div class="tab-pane fade" id="accepted" role="tabpanel" aria-labelledby="pending-tab">
              <ul class="list-group">
                {% if accepted %}
                  {% for r in accepted %}
                    <li class="list-group-item list-group-item-{{ r.color }} d-flex">
                      <div class="col-3 text-center"><a class="list-group-item list-group-item-{{ r.color }} h-100">{{ r.transfer.external_course.college_name }}</a></div>
                      <div class="col-4 text-center"><a href="{{ r.url }}" class="list-group-item list-group-item-{{ r.color }} list-group-item-action h-100">{{ r.transfer.external_course }}</a></div>
                      <div class="col-4 text-center"><a href="{% url 'internalcourse' r.transfer.internal_course.pk %}" class="list-group-item list-group-item-{{ r.color }} list-group-item-action h-100">{{ r.transfer.internal_course }}</a></div>
                      <div class="col-1 text-center"><button type="button" data-id="{{ r.id }}" class="open-ActionModal btn btn-{{ r.btn }}" data-bs-toggle="modal" data-bs-target="#actionModal">⋮</button></div>
                    </li>
                  {% endfor %}
                {% else %}
                  <li class="list-group-item list-group-item-light d-flex">No Accepted Transfer Requests Found.</li>
                {% endif %}
              </ul>
            </div>

            <!-- Rejected Requests -->
            <div class="tab-pane fade" id="rejected" role="tabpanel" aria-labelledby="pending-tab">
              <ul class="list-group">
                {% if rejected %}
                  {% for r in rejected %}
                    <li class="list-group-item list-group-item-{{ r.color }} d-flex">
                      <div class="col-3 text-center"><a class="list-group-item list-group-item-{{ r.color }} h-100">{{ r.transfer.external_course.college_name }}</a></div>
                      <div class="col-4 text-center"><a href="{{ r.url }}" class="list-group-item list-group-item-{{ r.color }} list-group-item-action h-100">{{ r.transfer.external_course }}</a></div>
                      <div class="col-4 text-center"><a href="{% url 'internalcourse' r.transfer.internal_course.pk %}" class="list-group-item list-group-item-{{ r.color }} list-group-item-action h-100">{{ r.transfer.internal_course }}</a></div>
                      <div class="col-1 text-center"><button type="button" data-id="{{ r.id }}" class="open-ActionModal btn btn-{{ r.btn }}" data-bs-toggle="modal" data-bs-target="#actionModal">⋮</button></div>
                    </li>
                  {% endfor %}
                {% else %}
                  <li class="list-group-item list-group-item-light d-flex">No Rejected Transfer Requests Found.</li>
                {% endif %}
              </ul>
            </div>

            <!-- All Requests -->
            <div class="tab-pane fade" id="all" role="tabpanel" aria-labelledby="pending-tab">
              <ul class="list-group">
                {% if all %}
                  {% for r in all %}
                    <li class="list-group-item list-group-item-{{ r.color }} d-flex">
                      <div class="col-3 text-center"><a class="list-group-item list-group-item-{{ r.color }} h-100">{{ r.transfer.external_course.college_name }}</a></div>
                      <div class="col-4 text-center"><a href="{{ r.url }}" class="list-group-item list-group-item-{{ r.color }} list-group-item-action h-100">{{ r.transfer.external_course }}</a></div>
                      <div class="col-4 text-center"><a href="{% url 'internalcourse' r.transfer.internal_course.pk %}" class="list-group-item list-group-item-{{ r.color }} list-group-item-action h-100">{{ r.transfer.internal_course }}</a></div>
                      <div class="col-1 text-center"><button type="button" data-id="{{ r.id }}" class="open-ActionModal btn btn-{{ r.btn }}" data-bs-toggle="modal" data-bs-target="#actionModal">⋮</button></div>
                    </li>
                  {% endfor %}
                {% else %}
                  <li class="list-group-item list-group-item-light d-flex">No Transfer Requests Found.</li>
                {% endif %}
              </ul>
            </div>

          </div>
        </div>
      </div>

    </content>
    {% endblock %}
</body>
</html>




